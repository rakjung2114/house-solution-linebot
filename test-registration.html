<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô - The House Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .status-box { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h1>
            <p class="text-white opacity-90">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</p>
        </div>

        <div class="bg-white rounded-lg shadow-xl p-6">
            <h2 class="text-2xl font-semibold mb-6">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
            
            <div id="testResults">
                <div class="info status-box">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <button onclick="testEnvironment()" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-desktop mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
                </button>
                
                <button onclick="testGoogleScriptAPI()" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700">
                    <i class="fas fa-link mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Google Script API
                </button>
                
                <button onclick="testDatabaseConnection()" class="bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700">
                    <i class="fas fa-database mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                
                <button onclick="testFullRegistration()" class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-user-plus mr-2"></i>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                </button>
            </div>

            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div id="systemInfo" class="text-sm text-gray-600">
                    <p><strong>URL:</strong> <span id="currentUrl">-</span></p>
                    <p><strong>Protocol:</strong> <span id="protocol">-</span></p>
                    <p><strong>Google Script API:</strong> <span id="googleScriptStatus">-</span></p>
                    <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <span id="currentTime">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('googleScriptStatus').textContent = (typeof google !== 'undefined' && google.script) ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        document.getElementById('currentTime').textContent = new Date().toLocaleString('th-TH');

        function addResult(type, message) {
            const resultsDiv = document.getElementById('testResults');
            const resultBox = document.createElement('div');
            resultBox.className = `${type} status-box`;
            resultBox.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle mr-2"></i>${message}`;
            resultsDiv.appendChild(resultBox);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        function testEnvironment() {
            clearResults();
            addResult('info', '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°...');

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Protocol
            const isHTTPS = window.location.protocol === 'https:';
            const isFile = window.location.protocol === 'file:';
            
            if (isFile) {
                addResult('error', '‚ùå Protocol: file:// - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script ‡πÑ‡∏î‡πâ');
            } else if (isHTTPS) {
                addResult('success', '‚úÖ Protocol: HTTPS - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢');
            } else {
                addResult('warning', '‚ö†Ô∏è Protocol: HTTP - ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á');
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Script API
            if (typeof google !== 'undefined' && google.script) {
                addResult('success', '‚úÖ Google Apps Script API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            } else {
                addResult('error', '‚ùå Google Apps Script API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô Web App URL');
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console Errors
            const errors = [];
            const originalError = console.error;
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };

            setTimeout(() => {
                if (errors.length === 0) {
                    addResult('success', '‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö Console Errors');
                } else {
                    addResult('warning', `‚ö†Ô∏è ‡∏û‡∏ö Console Errors: ${errors.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
                console.error = originalError;
            }, 1000);
        }

        function testGoogleScriptAPI() {
            clearResults();
            
            if (typeof google === 'undefined' || !google.script) {
                addResult('error', '‚ùå Google Apps Script API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                addResult('info', 'üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script');
                return;
            }

            addResult('info', '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Script...');

            google.script.run
                .withSuccessHandler(result => {
                    try {
                        let data;
                        if (typeof result === 'string') {
                            data = JSON.parse(result);
                        } else {
                            data = result;
                        }

                        if (data.success) {
                            addResult('success', '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                            addResult('info', `üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${JSON.stringify(data, null, 2)}`);
                        } else {
                            addResult('error', `‚ùå Google Script ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ error: ${data.error}`);
                        }
                    } catch (error) {
                        addResult('error', `‚ùå Parse Error: ${error.message}`);
                        addResult('info', `Raw result: ${result}`);
                    }
                })
                .withFailureHandler(error => {
                    addResult('error', `‚ùå Google Script Error: ${error.message || error}`);
                })
                .testUserConnection();
        }

        function testDatabaseConnection() {
            clearResults();
            
            if (typeof google === 'undefined' || !google.script) {
                addResult('error', '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ - Google Apps Script API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                return;
            }

            addResult('info', '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');

            google.script.run
                .withSuccessHandler(result => {
                    try {
                        let data;
                        if (typeof result === 'string') {
                            data = JSON.parse(result);
                        } else {
                            data = result;
                        }

                        if (data.success) {
                            addResult('success', '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                            addResult('info', `üìà ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${data.activeCount || 0} ‡∏Ñ‡∏ô`);
                            addResult('info', `üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${data.count || 0} ‡∏Ñ‡∏ô`);
                        } else {
                            addResult('error', `‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`);
                        }
                    } catch (error) {
                        addResult('error', `‚ùå Parse Error: ${error.message}`);
                    }
                })
                .withFailureHandler(error => {
                    addResult('error', `‚ùå Database Connection Error: ${error.message || error}`);
                })
                .getMemberCount();
        }

        function testFullRegistration() {
            clearResults();
            
            if (typeof google === 'undefined' || !google.script) {
                addResult('error', '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ - Google Apps Script API ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                return;
            }

            addResult('info', '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á...');

            const testMemberData = {
                name: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                unit_number: 'TEST-001',
                phone: '081-234-5678',
                email: 'test@example.com',
                address: '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
                notes: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö - ' + new Date().toLocaleString('th-TH')
            };

            google.script.run
                .withSuccessHandler(result => {
                    try {
                        let data;
                        if (typeof result === 'string') {
                            data = JSON.parse(result);
                        } else {
                            data = result;
                        }

                        if (data.success) {
                            addResult('success', '‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                            addResult('info', `üé´ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${data.member_id}`);
                            addResult('warning', '‚ö†Ô∏è ‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ');
                        } else {
                            addResult('error', `‚ùå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`);
                        }
                    } catch (error) {
                        addResult('error', `‚ùå Parse Error: ${error.message}`);
                    }
                })
                .withFailureHandler(error => {
                    addResult('error', `‚ùå Registration Test Error: ${error.message || error}`);
                })
                .handleUserRegistration(testMemberData);
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = function() {
            testEnvironment();
        };
    </script>
</body>
</html>
